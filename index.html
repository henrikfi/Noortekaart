<script>
    // Initialize the map
    var map = L.map('map').setView([58.5953, 25.0136], 7);

    // BoundaryCanvas Layer
    fetch('estonia.json')
        .then(response => response.json())
        .then(geojson => {
            // Add BoundaryCanvas to only show Estonia
            var boundaryLayer = L.TileLayer.boundaryCanvas('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                boundary: geojson,
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);

            // Check if the geojson loads correctly
            if (!geojson || !geojson.features || geojson.features.length === 0) {
                console.error("Invalid GeoJSON file. Ensure it contains valid geometries.");
                return;
            }

            // Fit the map to Estonia's boundary
            var geoJsonLayer = L.geoJSON(geojson);
            map.fitBounds(geoJsonLayer.getBounds());

            // Optional: Add an outline for visual confirmation
            L.geoJSON(geojson, {
                style: {
                    color: "blue",
                    weight: 2,
                    fillColor: "#cce5ff",
                    fillOpacity: 0.4
                }
            }).addTo(map);
        })
        .catch(error => {
            console.error("Error loading GeoJSON:", error);
        });

    // Marker Logic
    var markers = {
        "Kool": [],
        "Noortekeskus": []
    };

    var marker1 = L.marker([58.5, 24.8]).bindPopup("Kool näidis");
    markers["Kool"].push(marker1);

    var marker2 = L.marker([59.4, 25.3]).bindPopup("Noortekeskus näidis");
    markers["Noortekeskus"].push(marker2);

    markers["Kool"].forEach(m => m.addTo(map));
    markers["Noortekeskus"].forEach(m => m.addTo(map));

    document.getElementById('filter-kool').addEventListener('change', function(e) {
        if (e.target.checked) {
            markers["Kool"].forEach(m => map.addLayer(m));
        } else {
            markers["Kool"].forEach(m => map.removeLayer(m));
        }
    });

    document.getElementById('filter-noortekeskus').addEventListener('change', function(e) {
        if (e.target.checked) {
            markers["Noortekeskus"].forEach(m => map.addLayer(m));
        } else {
            markers["Noortekeskus"].forEach(m => map.removeLayer(m));
        }
    });
</script>
